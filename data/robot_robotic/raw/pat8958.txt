The present invention is a method of controlling a robotic mechanism comprising both active and passive joints, where the motion of one or more of the passive joints is constrained by one or more constraints imposed on the mechanism by the environment, the mechanical construction of the mechanism or the nature of the task. The method is capable of controlling mechanisms with multiple sets of passive joints with multiple environmental constraints restricting the motion of the mechanism. In a preferred embodiment the novel method is used to control a surgical robot holding a surgical instrument inserted into a patient through a natural or man-made orifice.
Claims We claim: 1. A method of controlling a surgical robot mechanism having one or more active joints and one or more passive joints, where motion of said passive joints is constrained by one or more environmental constraints imposed on the mechanism, the method comprising the steps of: a. determining positions of said active joints and said passive joints of the mechanism; b. determining an actual pose of a target element; c. determining a pose difference between the actual pose and a desired pose of the target element; d. on a first iteration of the method, characterizing said environmental constraints on a motion of said passive joints, said environmental constraints comprising a surgical opening in a patient's body; e. Jacobian mapping effects of said environmental constraints, a motion of said active joints, and the motion of said passive joints on motion of the target element; f. characterizing a desired incremental motion of the target element; g. using the Jacobian mapping of the effects of said environmental constraints on the motion of said passive joints to determine an incremental active joint motion for each of said active joints, the incremental active joint motion producing an actual incremental motion of the target element, so that a difference between the desired incremental motion and the actual incremental motion of the target element is minimized; h. moving said active joints by the determined incremental active joint motion; and i. repeating steps a through h until the pose difference between the actual pose and the desired pose of the target element is less than a desired amount. 2. A method as in claim 1, wherein step d further comprises: on the first iteration of the method, characterizing said environmental constraints on the motion of said passive joints and, on subsequent iterations of the method, using the actual incremental motion of the target element to characterize said environmental constraints on the motion of said passive joints. 3. A method as in claim 1, wherein step d further comprises: on the first iteration of the method, characterizing said environmental constraints on the motion of said passive joints and characterizing and imposing one or more task constraints on the motion of said active joints, and on subsequent iterations, using the actual incremental motion of the target element to characterize said environmental constraints on the motion of said passive joints, wherein said task constraints are also used in determining the incremental active joint motion in step h. 4. A method as in claim 1 wherein the mechanism comprises a first set of said passive joints and a second set of said passive joints, said first set and said second set of passive joints being separated by one or more of said active joints. 5. A method of controlling a surgical robotic mechanism comprising a plurality of active joints and passive joints, the method comprising the steps of: a. determining positions of all of said active and passive joints of the mechanism; b. determining an actual pose of a target said element being rigidly attached at a distal end of said mechanism; c. determining a pose difference between the actual pose and a desired pose of the target element; d. on the first iteration, characterizing an environmental constraint on motion of the passive joints and imposing one or more task constraints on motion of the active joints of the mechanism, and on subsequent iterations using an actual incremental motion of the target element to update the characterization of the environmental constraint on the motion of the passive joints, said environmental constraint comprising a surgical opening in a patient's body; e. Jacobian mapping the effects of the environmental constraint, the motion of the active joints, and the motion of the passive joints on the motion of the target element; f. characterizing a desired incremental motion of the target element; g. using the Jacobian mapping of the effects of the environmental constraint on the motion of the passive joints and using the task constraints on the motion of the active joints to determine an incremental active joint motion for each of said active joints, the incremental active joint motions producing an actual incremental motion of the target element, so that the difference between the desired incremental motion and the actual incremental motion is minimized; h. moving the active joints by the determined incremental active joint motion, respectively; and i. repeating steps a through h until the pose difference between the actual and the desired pose of the target element is less than a desired amount. 6. The method as in claim 5 wherein the passive joints of the mechanism comprise a universal joint with two revolute degrees of freedom. 7. The method as in claim 5 wherein the target element comprises a surgical instrument. 8. A method for controlling a surgical robot, constrained by a surgical opening, said surgical robot comprising both active and passive joints, comprising steps of: quantifying constraints of a surgical opening in a body undergoing a surgical operation on said active joints and said passive joints; quantifying current positions of said active joints and said passive joints; quantifying an actual position of a target element using said current positions of said active joints and said passive joints; quantifying a desired position for said target element; calculating a Jacobian using said quantified constraints of the surgical opening in the body undergoing a surgical operation relating velocities in active joint space and passive joint space to velocities in Cartesian space for an incremental movement between said actual position and said desired position; and moving said active joints according to said Jacobian such that said surgical opening is undisturbed. 