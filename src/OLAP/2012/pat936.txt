A system and process for laser scan alignment for vehicle trajectories is provided. A representation of the map surface allows multiple scans to be simultaneously aligned to each other. Laser scans are fit to the template surface, and the template surface is re-estimated based on the fit of the scans. The result is a pose trajectory estimate that drifts less than standard approaches, and is more robust to outliers (such as moving objects) in the laser's field of view.
Claims What is claimed is: 1. A computer-implemented method for laser scan alignment comprising: splitting, by a laser scan alignment computer, an area covered by a plurality of laser scans into a first set of grid cells, the first set of grid cells having a first resolution; estimating, by the laser scan alignment computer, a first template surface representation for the first set of grid cells using original poses of the plurality of laser scans; aligning, by the laser scan alignment computer, each laser scan in the plurality of laser scans to the estimated first template surface representation to provide a first updated pose for each laser scan in the plurality of laser scans; splitting, by the laser scan alignment computer, the area covered by the plurality of laser scans into a second set of grid cells, the second set of grid cells having a second resolution, wherein the second resolution of the second set of grid cells is finer than the first resolution of the first set of grid cells; estimating, by the laser scan alignment computer, a second template surface representation for the second set of grid cells using the first updated poses for the plurality of laser scans; repeating, by the laser scan alignment computer, the splitting the area into the second set of grid cells, and the estimating the second template surface representation until the aligned plurality of laser scans substantially converges with the second template surface representation; simultaneously aligning, by the laser scan alignment computer, the plurality of laser scans to each other to provide a final pose for each laser scan in the plurality of laser scans; dividing, by the laser scan alignment computer, the plurality of laser scans into overlapping groups of laser scans; and providing the estimated second template surface representation to a display as a map of the area covered by the plurality of laser scans, wherein the splitting the area covered by the plurality of laser scans into the first set of grid cells comprises splitting the mea covered by each group of laser scans in the overlapping groups of laser scans into the first set of grid cells, and wherein the aligning each laser scan in the plurality of laser scans to the estimated first template surface representation comprises aligning each group of laser scans in the overlapping groups of laser scans to the estimated first template surface representation to provide the updated pose for each group of laser scans in the overlapping groups of laser scans. 2. A computer-implemented method for laser scan alignment comprising: splitting, by a laser scan alignment computer, an area covered by a plurality of laser scans into a first set of grid cells, the first set of grid cells having a first resolution, wherein the splitting the area covered by the plurality of laser scans into the first set of grid cells further comprises approximating, by the laser scan alignment computer, a surface inside each grid cell in the first set of grid cells using a local line segment, the local line segment corresponding to a shape of the surface inside each grid cell in the first set of grid cells; estimating, by the laser scan alignment computer, a first template surface representation for the first set of grid cells using original poses of the plurality of laser scans; aligning, by the laser scan alignment computer, each laser scan in the plurality of laser scans to the estimated first template surface representation to provide a first updated pose for each laser scan in the plurality of laser scans; splitting, by the laser scan alignment computer, the area covered by the plurality of laser scans into a second set of grid cells, the second set of grid cells having a second resolution, wherein the second resolution of the second set of grid cells is finer than the first resolution of the first set of grid cells; estimating, by the laser scan alignment computer, a second template surface representation for the second set of grid cells using the first updated poses for the plurality of laser scans; and providing, by the laser scan alignment computer, the estimated second template surface representation to a display as a map of the area covered by the plurality of laser scans. 3. The method of claim 2, wherein the approximating the surface inside each grid cell comprises: determining, by the laser scan alignment computer, a first normal orientation of a first set of scan points within each grid cell of the first set of grid cells; determining, by the laser scan alignment computer, a second normal orientation of a second set of scan points within each grid cell of the first set of grid cells, wherein the second normal orientation is different from the first normal orientation; and approximating, by the laser scan alignment computer, the surface inside each grid cell in the first set of grid cells using the first and second local line segments corresponding to the respective first and second normal orientations. 4. The method of claim 2, wherein the estimating the first and second template surface representations comprises: performing, by the laser scan alignment computer, principal component analysis for each grid cell of the respective first and second set of grid cells; and recovering, by the laser scan alignment computer, the local line segment and the standard deviations of laser scan points relative to the local line segment for each grid cell in the respective first and second set of grid cells. 5. A system for laser scan alignment comprising: a grid generator configured to split an area covered by a plurality of laser scans into a first set of grid cells, the first set of grid cells having a first resolution, and to split the area covered by the plurality of laser scans into a second set of grid cells, the second set of grid cells having a second resolution, wherein the second resolution of the second set of grid cells is finer than the first resolution of the first set of grid cells, and wherein the grid generator is further configured to divide the plurality of laser scans into overlapping groups of laser scans and configured to split the area covered by each group of laser scans in the overlapping groups of laser scans into the first set of grid cells; a template surface estimator configured to estimate a first template surface representation for the first set of grid cells using original poses of the plurality of laser scans and to estimate a second template surface representation for a second set of grid cells using updated poses for the plurality of laser scans; and a laser scan aligner configured to align each laser scan in the plurality of laser scans to the estimated first template surface representation to provide the updated pose for each laser scan in the plurality of laser scans, simultaneously align the plurality of laser scans to each other to provide a final pose for each laser scan in the plurality of laser scans, and align each group of laser scans in the overlapping groups of laser scans to the estimated first template surface representations to provide the updated pose for each group of laser scans in the overlapping groups of laser scans, wherein the laser scan aligner, the grid generator, and the template surface estimator are further configured to repeat the respective alignment, the split of the area into the second set of grid cells, and the estimation of the second template surface representation until the aligned plurality of laser scans substantially converges with the second template surface representation. 6. A system for laser scan alignment comprising: a grid generator configured to split an area covered by a plurality of laser scans into a first set of grid cells, the first set of grid cells having a first resolution, to split the area covered by the plurality of laser scans into a second set of grid cells, the second set of grid cells having a second resolution, wherein the second resolution of the second set of grid cells is finer than the first resolution of the first set of grid cells, and to approximate a surface inside each grid cell in the first set of grid cells using a local line segment, the local line segment corresponding to a shape of the surface inside each grid cell in the first set of grid cells; a template surface estimator configured to estimate a first template surface representation for the first set of grid cells using original poses of the plurality of laser scans and to estimate a second template surface representation for a second set of grid cells using updated poses for the plurality of laser scans; and a laser scan aligner configured to align each laser scan in the plurality of laser scans to the estimated first template surface representation to provide the updated pose for each laser scan in the plurality of laser scans. 7. The system of claim 6, wherein the grid generator is configured to determine a first normal orientation of a first set of scan points within each grid cell of the first set of grid cells, further configured to determine a second normal orientation of a second set of scan points within each grid cell of the first set of grid cells, wherein the second normal orientation is different from the first normal orientation, and further configured to approximate the surface inside each grid cell in the first set of grid cells using the first and second local line segments corresponding to the respective first and second normal orientations. 8. The system of claim 6, wherein the template surface estimator is configured to perform principal component analysis for each grid cell of the respective first and second set of grid cells and further configured to recover the local line segment and the standard deviations of laser scan points relative to the local line segment for each grid cell in the respective first and second set of grid cells. 9. A computer-implemented method for laser scan alignment comprising: splitting, by a laser scan alignment computer, an area covered by a plurality of laser scans into a set of grid cells; estimating, by the laser scan alignment computer, a first template surface representation for the set of grid cells using original poses of the plurality of laser scans, the first template surface representation having a first resolution; aligning, by the laser scan alignment computer, each laser scan in the plurality of laser scans to the estimated first template surface representation to provide a first updated pose for each laser scan in the plurality of laser scans; estimating, by the laser scan alignment computer, a second template surface representation for the set of grid cells using the first updated poses for the plurality of laser scans, the second template surface representation having a second resolution, wherein the second resolution of the second template surface representation is finer than the first resolution of the first template surface representation; aligning, by the laser scan alignment computer, the plurality of laser scans to the second template surface representation to provide a second updated pose for each laser scan in the plurality of laser scans; providing, by the laser scan alignment computer, the second template surface representation to a display as a map of the area covered by the plurality of laser scans; dividing, by the laser scan alignment computer, the plurality of laser scans into overlapping groups of laser scans, wherein the splitting the area covered by the plurality of laser scans into the set of grid cells comprises splitting the area covered by each group of laser scans in the overlapping groups of laser scans into the set of grid cells, wherein the aligning each laser scan in the plurality of laser scans to the estimated first template surface representation comprises aligning, by the laser scan alignment computer, each group of laser scans in the overlapping groups of laser scans to the estimated first template surface representation to provide the first updated pose for each group of laser scans in the overlapping groups of laser scans, and wherein the aligning each laser scan in the plurality of laser scans to the estimated second template surface representation comprises aligning, by the laser scan alignment computer, each group of laser scans in the overlapping groups of laser scans to the estimated second template surface representation to provide the second updated pose for each group of laser scans in the overlapping groups of laser scans; and estimating, by the laser scan alignment computer, the first template surface representation for the set of grid cells using the second updated pose for each group of laser scans in the overlapping groups of laser scans, the first template surface representation having a third resolution, wherein the third resolution of the first template surface representation is finer than the second resolution of the second template surface representation. 