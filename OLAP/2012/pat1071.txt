External beam radiotherapy treatment workflow scheduling and optimization. The system and method provides for determining a workflow metamodel, receiving a treatment plan, determining a treatment schedule corresponding to the workflow metamodel and treatment plan, taking into account safety by determining alternative treatment schedules, computing a safety index, and selecting one alternative treatment schedule that satisfies a safety threshold and that provides an optimal schedule.
Claims We claim: 1. A method for operating radio-therapy equipment comprising a radio-therapy control system, having a central processing system and memory, to control radiotherapy treatment room equipment, including at least one piece of radio-therapy equipment selected from patient positioning equipment, proton beam delivery equipment, and imaging equipment, providing an external beam radiotherapy treatment at a treatment center, comprising: receiving a workflow metamodel into the radio-therapy control system, the workflow metamodel specifying steps carried out at the treatment center when delivering treatment wherein the metamodel comprises a set of actions including an action performed by the at least one piece of radio-therapy equipment, execution time required for each action, actors required for each action, and restrictions on ordering of actions; receiving into the radio-therapy control system a treatment plan describing steps executed by at least one piece of radio-therapy equipment; operating the radio-therapy control system to determine a treatment schedule defining a sequence and timing of activities corresponding to the workflow metamodel and the treatment plan that avoids violating a safety threshold of a safety index associated with executing the treatment schedule, the determining of a treatment schedule comprising determining alternative treatment schedules that are possible according to the workflow metamodel; computing a safety index for each such alternative treatment schedule using a function having a parameter selected from constraints on couch angles, couch speeds, patient proximity to individual pieces of equipment, couch proximity to individual pieces of equipment, speed of the couch positioner mechanism, and the range of motion of the couch positioner mechanism; and selecting one alternative treatment schedule having a safety index satisfying the safety threshold and that provides a schedule optimized to minimize treatment time, or to maximize patient or equipment safety; and operating the at least one piece of radio-therapy equipment according to the alternative treatment schedule. 2. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1, wherein the safety index is computed by using a model of the at least one piece of radio-therapy equipment, a model of a patient to determine the risk of collisions between the at least one piece of radio-therapy equipment and the patient. 3. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 wherein the at least one piece of radio-therapy equipment comprises a first piece of radio-therapy equipment and a second piece of equipment and wherein computing the safety index further comprises using a model of the first piece of radio-therapy equipment and a model of a second piece of equipment. 4. The method of operating a radio-therapy equipment providing an external beam radiotherapy treatment of claim 1 wherein operating the radio-therapy control system to determine the safety index comprises operating the radio-therapy control system to simulate motion of at least one piece of radio-therapy equipment and to determine, for a plurality of time increments, distances between at least one piece of equipment and the patient. 5. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 wherein operating the radio-therapy control system to determine the safety index comprises operating the radio-therapy control system to take into account estimated errors in the model of the at least one piece of radio-therapy equipment and a model of a patient. 6. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 5 wherein to take into account the estimated errors in the model of the at least one piece of radio-therapy equipment and a model of a patient comprises to take into account at least one uncertainty selected from the set including the maximum Cartesian difference between the model of the rigid body of a piece of equipment or the patient and the actual shape of the rigid body of a piece of equipment or the patient, the uncertainty associated with a sensor tracking motion of a rigid body of a piece of equipment, the uncertainty of the position of the registered position of the patient and the actual position of the patient, uncertainty associated with stopping distance of a piece of equipment, uncertainty caused by communications latency. 7. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 wherein the workflow metamodel is described as a sequence of steps each having associated therewith an action, a set of resources and actors, constraints between actions, and an expected elapsed time for executing the action, and wherein the determination of alternative treatment schedules and selection of one alternative treatment schedule associated with delivery of the treatment plan comprises resequencing the actions in the workflow metamodel, or identifying sequences of sub-steps that may be performed in parallel thereby reducing a cumulative elapsed time, or any combination of these steps. 8. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 7 wherein operating the radio-therapy control system to compute the safety index comprises using a model of the at least one piece of radio-therapy equipment, a model of a patient to determine the risk of collisions between the at least one piece of radio-therapy equipment and the patient; and further comprising: based on a determination that a risk of collision is high, operating the radio-therapy control system to determine a sequence of movement of pieces of equipment according to a list of priorities that prioritizes the order in which different pieces of equipment are to be moved when a risk of collision is high. 9. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 7 wherein the expected elapsed time is computed from a model of an actor performing the action wherein the actor is selected from the at least one piece of radiotherapy equipment and a radio therapy technician. 10. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 further comprises excluding a candidate treatment schedule from consideration if the optimization results in a safety index violating a proscribed constraint. 11. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 further comprising operating the radio-therapy control system to identify tasks that may be performed in parallel by a plurality of resources and scheduling the tasks that may be performed in parallel wherein a first resource performs a first task that may be performed in parallel with a second task and a second resource performs the second task that may be performed in parallel with the first task whereby the first and second tasks that may be performed in parallel are performed in parallel. 12. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 wherein the determination of the optimized schedule is performed by a constraint programming. 13. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 wherein the determination of the optimized schedule is performed using the Bellman-Ford algorithm. 14. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1 further comprising: operating the radio-therapy control system to resequence beams specified in the treatment plan by sorting beam reconfiguration operations according to a precedence relationship between the various types of configuration changes required going from one beam configuration to a next beam configuration encountered in the treatment plan. 15. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 14 wherein each beam is defined by a plurality of items selected from snout selection, compensator thickness, beam delivery angle, patient support angle, isocenter, snout extension and the sorting is performed by a lexicographical sorting on the selected items. 16. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1, wherein the safety index is computed as a function of constraints on couch angles. 17. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1, wherein the safety index is computed as a function of constraints on couch speeds. 18. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1, wherein the safety index is computed as a function of constraints on patient proximity to individual pieces of equipment. 19. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1, wherein the safety index is computed as a function of constraints on speed of the couch positioner mechanism. 20. The method of operating a radio-therapy equipment for providing an external beam radiotherapy treatment of claim 1, wherein the safety index is computed as a function of constraints on the range of motion of the couch positioner mechanism. 21. A radio-therapy control computer having a central processing unit and a memory containing computer program instructions, the central processing unit operable to execute the computer program instructions, and wherein the radio-therapy control computer is connected to at least one piece of external beam radiotherapy delivery equipment, the instructions including instruction to cause the computer to direct the at least one piece of external beam radio-therapy system to perform a sequence of actions in the provisioning of an external beam radiotherapy treatment, the instructions comprising instructions to cause the central processing unit to: receive a workflow metamodel specifying steps carried out at the treatment center when delivering treatment wherein the metamodel comprises a set of actions including an action performed by the at least one piece of radio-therapy equipment, execution time required for each action, actors required for each action, and restrictions on ordering of actions; receive a treatment plan describing steps executed by at least one piece of radio-therapy equipment; determine a treatment schedule defining a sequence and timing of activities corresponding to the workflow metamodel and the treatment plan that avoids violating a safety threshold of a safety index associated with executing the treatment schedule, the determining of a treatment schedule comprising instructions to determine alternative treatment schedules that are possible according to the workflow metamodel; compute a safety index for each alternative treatment schedule using a function having a parameter selected from constraints on couch angles, couch speeds, patient proximity to individual pieces of equipment, couch proximity to individual pieces of equipment, speed of the couch positioner mechanism, and the range of motion of the couch positioner mechanism; and select one alternative treatment schedule having a safety index satisfying the safety threshold and that provides a schedule optimized to minimize treatment time or to maximize patient or equipment safety; and control the operation of the at least one piece of radio-therapy equipment according to the alternative treatment schedule. 22. The radio-therapy control computer of claim 21, wherein the safety index is computed by using a model of the at least one piece of radio-therapy equipment, a model of a patient to determine the risk of collisions between the at least one piece of radio-therapy equipment and the patient. 23. The radio-therapy control computer of claim 21 wherein the at least one piece of radio-therapy equipment comprises a first piece of radio-therapy equipment and a second piece of equipment and wherein computing the safety index further comprises using a model of the first piece of radio-therapy equipment and a model of a second piece of equipment. 24. The radio-therapy control computer of claim 21 wherein the instructions to compute the safety index comprise instructions to simulate motion of the at least one piece of radio-therapy equipment and to computer, for a plurality of time increments, distances between the at least one piece of equipment and the patient. 25. The radio-therapy control computer of claim 21 wherein the instructions to compute the safety index comprise instructions to take into account estimated errors in the model of the at least one piece of radio-therapy equipment and a model of a patient. 26. The radio-therapy control computer of claim 25 wherein the instructions to take into account the estimated errors in the model of the at least one piece of radio-therapy equipment and a model of a patient comprises instructions to take into account at least one uncertainty selected from the set including the maximum Cartesian difference between the model of the rigid body of a piece of equipment or the patient and the actual shape of the rigid body of a piece of equipment or the patient, the uncertainty associated with a sensor tracking motion of a rigid body of a piece of equipment, the uncertainty of the position of the registered position of the patient and the actual position of the patient, uncertainty associated with stopping distance of a piece of equipment, uncertainty caused by communications latency. 27. The radio-therapy control computer of claim 21 wherein the workflow metamodel is described as a sequence of steps each having associated therewith an action, a set of resources and actors, constraints between actions, and an expected elapsed time for executing the action, and wherein the determination of alternative treatment schedules and selection of one alternative treatment schedule associated with delivery of the treatment plan comprises resequencing the actions in the workflow metamodel, or identifying sequences of sub-steps that may be performed in parallel thereby reducing a cumulative elapsed time, or any combination of these steps. 28. The radio-therapy control computer of claim 27 wherein computing the safety index comprises using a model of the at least one piece of radio-therapy equipment, a model of a patient to determine the risk of collisions between the at least one piece of radio-therapy equipment and the patient; and further comprising instructions to: based on a determination that if a risk of collision is high, sequence movement of pieces of equipment according to a list of priorities that prioritizes the order in which different pieces of equipment are to be moved when a risk of collision is high. 29. The radio-therapy control computer of claim 27 wherein the instructions to cause the computer system to compute the expected elapsed time includes instructions to compute the expected elapsed time from a model of an actor performing the action wherein the actor is selected from the at least one piece of radiotherapy equipment and a radio therapy technician. 30. The radio-therapy control computer of claim 21 further comprises instructions to cause the computer system to exclude a schedule optimization from consideration if the optimization results in a safety index violating a proscribed constraint. 31. The radio-therapy control computer of claim 21 further comprising instructions to cause the computer system to identify tasks that may be performed in parallel by a plurality of resources and to schedule the tasks that may be performed in parallel wherein a first resource performs a first task that may be performed in parallel with a second task and a second resource performs the second task that may be performed in parallel with the first task whereby the first and second tasks that may be performed in parallel are performed in parallel. 32. The radio-therapy control computer of claim 21 wherein the instructions to determine the optimized schedule include instructions to cause the computer system to determine the optimized schedule by constraint programming. 33. The radio-therapy control computer of claim 21 wherein the instructions to determine the optimized schedule include instructions to cause the computer system to determine the optimized schedule by applying the Bellman-Ford algorithm. 34. The radio-therapy control computer of claim 21 further comprising instructions: to resequence beams specified in the treatment plan by sorting beam reconfiguration operations according to a precedence relationship between the various types of configuration changes required going from one beam configuration to a next beam configuration encountered in the treatment plan. 35. The radio-therapy control computer of claim 34 wherein each beam is defined by a plurality of items selected from snout selection, compensator thickness, beam delivery angle, patient support angle, isocenter, snout extension and the sorting is performed by a lexicographical sorting on the selected items. 36. The radio-therapy control computer of claim 21, wherein the safety index is computed as a function of constraints on couch angles. 37. The radio-therapy control computer of claim 21, wherein the safety index is computed as a function of constraints on couch speeds. 38. The radio-therapy control computer of claim 21, wherein the safety index is computed as a function of constraints on patient proximity to individual pieces of equipment. 39. The radio-therapy control computer of claim 21, wherein the safety index is computed as a function of constraints on speed of the couch positioner mechanism. 40. The radio-therapy control computer of claim 21, wherein the safety index is computed as a function of constraints on the range of motion of the couch positioner mechanism. 41. A non-transitory computer readable storage medium for storing computer program instructions, the computer readable storage medium comprising: instructions to cause a computer system, connected to an external beam radiotherapy treatment system at a treatment center, to: determine a workflow metamodel specifying steps carried out at the treatment center when delivering treatment wherein the metamodel comprises a set of actions, execution time required for each action, actors required for each action, and restrictions on ordering of actions; receive a treatment plan describing steps executed by at least one piece of radio-therapy equipment; and determine a treatment schedule defining a sequence and timing of activities corresponding to the workflow metamodel and the treatment plan that avoids violating a safety threshold of a safety index associated with executing the treatment schedule, the instructions to cause the computer system to determine a treatment schedule comprises instructions to cause the computer system to determine alternative treatment schedules that are possible according to the workflow metamodel; compute a safety index for each alternative treatment schedule using a function having a parameter selected from constraints on couch angles, couch speeds, patient proximity to individual pieces of equipment, couch proximity to individual pieces of equipment, speed of the couch positioner mechanism, and the range of motion of the couch positioner mechanism; and select one alternative treatment schedule having a safety index satisfying the safety threshold and that provides a schedule optimized to minimize treatment time or to maximize patient or equipment safety. 42. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the instructions to compute the safety index include instruction to cause the computer system to compute the safety index by using a model of the at least one piece of radio-therapy equipment, a model of a patient to determine the risk of collisions between the at least one piece of radio-therapy equipment and the patient. 43. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the at least one piece of radio-therapy equipment comprises a first piece of radio-therapy equipment and a second piece of equipment and wherein computing the safety index further comprises using a model of the first piece of radio-therapy equipment and a model of a second piece of equipment. 44. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the instructions to compute the safety index include instruction to cause the computer system to simulate motion of at least one piece of radio-therapy equipment and to determine, for a plurality of time increments, distances between at least one piece of equipment and the patient. 45. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the instructions to compute the safety index include instruction to cause the computer system to determine the safety index taking into account estimated errors in the model of the at least one piece of radio-therapy equipment and a model of a patient. 46. The non-transitory computer readable storage medium for storing computer program instructions of claim 45 wherein the instructions computing the estimated errors in the model of the at least one piece of radio-therapy equipment and a model of a patient comprises instructions to take into account at least one uncertainty selected from the set including the maximum Cartesian difference between the model of the rigid body of a piece of equipment or the patient and the actual shape of the rigid body of a piece of equipment or the patient, the uncertainty associated with a sensor tracking motion of a rigid body of a piece of equipment, the uncertainty of the position of the registered position of the patient and the actual position of the patient, uncertainty associated with stopping distance of a piece of equipment, uncertainty caused by communications latency. 47. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the workflow metamodel is described as a sequence of steps each having associated therewith an action, a set of resources and actors, constraints between actions, and an expected elapsed time for executing the action, and wherein the determination of the alternative treatment schedules and selection of one alternative treatment schedule associated with executing the treatment plan comprises resequencing the actions in the workflow metamodel, or identifying sequences of sub-steps that may be performed in parallel thereby reducing a cumulative elapsed time, or any combination of these steps. 48. The non-transitory computer readable storage medium for storing computer program instructions of claim 47 wherein computing the safety index is by using a model of the at least one piece of radio-therapy equipment, a model of a patient to determine the risk of collisions between the at least one piece of radio-therapy equipment and the patient; and further comprising instructions to cause a computer system connected to an external beam radiotherapy treatment system to: based on a determination that if a risk of collision is high, sequencing movement of pieces of equipment according to a list of priorities that prioritizes the order in which different pieces of equipment are to be moved when a risk of collision is high. 49. The non-transitory computer readable storage medium for storing computer program instructions of claim 47 further comprising instruction to cause a computer system to compute the expected elapsed time from a model of an actor performing the action wherein the actor is selected from the at least one piece of radiotherapy equipment and a radio therapy technician. 50. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 further comprising instructions to cause a computer system connected to an external beam radiotherapy treatment system to exclude a candidate treatment schedule from consideration if the optimization results in a safety index violating a proscribed constraint. 51. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 further comprising instruction to cause a computer system to identify tasks that may be performed in parallel by a plurality of resources and scheduling the tasks that may be performed in parallel wherein a first resource performs a first task that may be performed in parallel with a second task and a second resource performs the second task that may be performed in parallel with the first task whereby the first and second tasks that may be performed in parallel are performed in parallel. 52. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the instruction to determine the optimized schedule includes instructions to determine the optimized schedule by a constraint programming. 53. The non-transitory computer readable storage medium for storing computer program instructions of claim 41 wherein the instruction to determine the optimized schedule includes instructions to determine the optimized schedule by using the Bellman-Ford algorithm. 54. The non-transitory computer computer readable storage medium for storing computer program instructions of claim 41 further comprising instruction to cause a computer system to: resequence beams specified in the treatment plan by sorting beam reconfiguration operations according to a precedence relationship between the various types of configuration changes required going from one beam configuration to a next beam configuration encountered in the treatment plan. 55. The non-transitory computer readable storage medium for storing computer program instructions of claim 54 wherein each beam is defined by a plurality of items selected from snout selection, compensator thickness, beam delivery angle, patient support angle, isocenter, snout extension and the sorting is performed by a lexicographical sorting on the selected items. 56. The non-transitory computer readable storage medium for storing computer program instructions of claim 41, wherein the safety index is computed as a function of constraints on couch angles. 57. The non-transitory computer readable storage medium for storing computer program instructions of claim 41, wherein the safety index is computed as a function of constraints on couch speeds. 58. The non-transitory computer readable storage medium for storing computer program instructions of claim 41, wherein the safety index is computed as a function of constraints on patient proximity to individual pieces of equipment. 59. The non-transitory computer readable storage medium for storing computer program instructions of claim 41, wherein the safety index is computed as a function of constraints on speed of the couch positioner mechanism. 60. The non-transitory computer readable storage medium for storing computer program instructions of claim 41, wherein the safety index is computed as a function of constraints on the range of motion of the couch positioner mechanism. 