An image-guided radiosurgery method and system are presented that use 2D/3D image registration to keep the radiosurgical beams properly focused onto a treatment target. A pre-treatment 3D scan of the target is generated at or near treatment planning time. A set of 2D DRRs are generated, based on the pre-treatment 3D scan. At least one 2D x-ray image of the target is generated in near real time during treatment. The DRRs are registered with the x-ray images, by computing a set of 3D transformation parameters that represent the change in target position between the 3D scan and the x-ray images. The relative position of the radiosurgical beams and the target is continuously adjusted in near real time in accordance with the 3D transformation parameters. A hierarchical and iterative 2D/3D registration algorithm is used, in which the transformation parameters that are in-plane with respect to the image plane of the x-ray images are computed separately from the out-of-plane transformation parameters.
Claims What is claimed is: 1. A method in image guided radiosurgery for aligning the position of a treatment target relative to a radiosurgical beam generator during treatment, the method comprising: a. generating a pre-treatment 3D scan showing an initial position of said target at treatment planning time; b. generating a set of 2D reconstructed images from said 3D scan, wherein the set of 2D reconstructed images corresponds to perturbations from said initial position along fewer than six degrees of freedom; c. generating one or more 2D x-ray images of said target, wherein said x-ray images show a current position of said target at a current time during treatment; d. registering said reconstructed images that correspond to perturbations from the initial position along fewer than six degrees of freedom with said x-ray images by computing a set of 3D transformation parameters that represent the change in position of said target between said initial position of said 3D scan and said current position of said x-ray images along six degrees of freedom, wherein said 3D transformation parameters are 3D rigid body transformation parameters, and wherein said 3D transformation parameters are represented by three translations and three rotations (x, y, z, r, p, w); wherein x, y, z represent the translations of said target in the directions of three mutually orthogonal axes, respectively, and wherein r, p, w represent three rotations (roll, pitch, yaw) about said three orthogonal axes; and e. adjusting the relative position of said radiosurgical beam generator to said target by the amount prescribed by said 3D transformation parameters computed in step d, wherein said target is allowed six degrees of freedom of position. 2. A method in accordance with claim 1, wherein said x-ray images generated in step c comprises x-ray projection images that represent at least two orthogonal projections A and B of said target onto respective projection image planes, said x-ray projection images being formed by transmitting at least two x-ray imaging beams through said target and onto said respective image planes, wherein each imaging beam is received by a respective x-ray camera after passing through said target. 3. A method in accordance with claim 2, wherein step b of generating reconstructed images comprises generating two sets of reconstructed images, one set for each of said projections A and B. 4. A method in accordance with claim 3, wherein step d of registering said reconstructed images with said x-ray images comprises: A. individually registering each x-ray projection image A and B with their respective set of reconstructed images, by determining a separate set of transformation parameters for each projection x-ray image; and B. combining the resulting parameters for each projection to obtain said 3D transformation parameters. 5. A method in accordance with claim 4, wherein said transformation parameters for each of said projections A and B are described by two out-of-plane rotational parameters (r.sub.A, .phi..sub.A) and (r.sub.B, .phi..sub.B) respectively, and by three in-plane transformation parameters (x.sub.A, y.sub.A, .theta..sub.A) and (x.sub.B, y.sub.B, .theta..sub.B), respectively. 6. A method in accordance with claim 5, wherein said 2D reconstructed images are digitally reconstructed radiographs (DRRs), and wherein step b of generating said 2D reconstructed images comprises: i) for each projection, specifying a set of rotation angles for each of said out-of-plane rotation parameters r and .phi., N.sub.r being the number of rotation angles for rotation parameter r, and N.phi. being the number of rotation angles for rotation parameter .phi.; and ii) generating two sets of DRRs, one set for each of said projections A and B, wherein each set includes DRRs that correspond to different combinations of said out-of-plane rotation angles, so that the number of DRRs in each set is N.sub.r*N.sub..phi.. 7. A method in accordance with claim 6, wherein the step of generating 2D reconstructed images further comprises the step of computing a set of in-plane rotated DRR images by performing a plurality of in-plane rotations on said DRRs, thereby creating a set of in-plane rotated reference DRRs for each projection. 8. A method in accordance with claim 7, wherein said step of creating reference DRRs is performed offline. 9. A method in accordance with claim 2, wherein the step of computing said 3D transformation parameters comprises: i) individually computing the transformation parameters (x.sub.A, y.sub.A, .theta..sub.A) and (x.sub.B, y.sub.B, .theta..sub.B)for each projection image A and B; and ii) combining the transformation parameters for projection A with the transformation parameters for projection B so as to obtain said 3D transformation parameters, and wherein said 3D transformation parameters are represented by three translations and three rotations (x, y, z, r, p, w). 10. A method in accordance with claim 9, wherein said 3D transformation parameters are related to the transformation parameters for projections A and B by the following relationship: x=(x.sub.A+x.sub.B)/2, y=(y.sub.A-y.sub.B)/ 2, z=(y.sub.A+y.sub.B)/ 2, r=(r.sub.A+r.sub.B)/2, p=(.theta..sub.B-.theta..sub.A)/ 2, w=(.theta..sub.B+.theta..sub.A)/ 2. 11. method in image guided radiosurgery for aligning the position of a treatment target relative to a radiosurgical beam generator during treatment, the method comprising: a. generating a pre-treatment 3D scan showing an initial position of said target at treatment planning time; b. generating a set of 2D reconstructed images from said 3D scan, wherein the set of 2D reconstructed images corresponds to perturbations from said initial position along fewer than six degrees of freedom; c. generating one or more 2D x-ray images of said target, wherein said x-ray images show a current position of said target at a current time during treatment, wherein said x-ray images comprise x-ray projection images that represent at least two orthogonal projections A and B of said target onto respective projection image planes, said x-ray projection images being formed by transmitting at least two x-ray imaging beams through said target and onto said respective image planes, wherein each imaging beam is received by a respective x-ray camera after passing through said target; d. registering said reconstructed images that correspond to perturbations from the initial position along fewer than six degrees of freedom with said x-ray images by computing a set of 3D transformation parameters that represent the change in position of said target between said initial position of said 3D scan and said current position of said x-ray images along six degrees of freedom, wherein computing said 3D transformation parameters comprises: individually computing the transformation parameters (x.sub.A, y.sub.A, .theta..sub.A) and (x.sub.B, y.sub.B, .theta..sub.B)for each projection image A and B, wherein computing the transformation parameters for each projection comprises: i) computing in-plane transformation parameters using in-plane rotated reference digitally reconstructed radiographs (DRRs); and thereafter ii) estimating out-of-plane rotation parameters using the in-plane transformation parameters computed in step i) above; and thereafter iii) iteratively refining said in-plane and out-of-plane transformation parameters, until said parameters converge to a sufficient accuracy; and combining the transformation parameters for projection A with the transformation parameters for projection B so as to obtain said 3D transformation parameters; and wherein said 3D transformation parameters are represented by three translations and three rotations (x, y, z, r, p, w); and e. adjusting the relative position of said radiosurgical beam generator to said target by the amount prescribed by said 3D transformation parameters computed in step d, wherein said target is allowed six degrees of freedom of position. 12. A method according to claim 11, wherein step i) is performed using 3D multi-level matching, and a sum of absolute difference similarity measure. 13. A method according to claim 11, wherein step ii) is performed using a 1D search and a pattern intensity similarity measure. 14. A method according to claim 13, wherein step iii) comprises: a) refining the in-plane translation parameters x and y using 2-D sub-pixel matching; and thereafter b) refining the in-plane rotation parameter using 1-D interpolation. 15. A method in accordance with claim 11 wherein said 3D scan comprises at least one of: a CT scan, an MRI scan, an ultrasound scan, and a PET scan. 16. A method of image registration, comprising: generating a pre-treatment 3D scan showing an initial position of a target at treatment planning time; generating a first set of 2D images and a second set of 2D images from said pre-treatment 3D scan of said target prior to treatment, wherein each of the first set of 2D images and the second set of 2D images correspond to perturbations from said initial position along fewer than six degrees of freedom; generating a first x-ray image and a second x-ray image of the target to show a current position of said target during treatment; registering the first x-ray image with the first set of 2D images by computing a first set of up to five transformation parameters that represent at most a first five degrees of freedom; registering the second x-ray image with the second set of 2D images by computing a second set of up to five transformation parameters that represent at most a second five degrees of freedom; and combining the first set of transformation parameters and the second set of transformation parameters to obtain a combined set of six 3D transformation parameters that represents a change between the initial position and the current position of the target, wherein the combined set of six 3D transformation parameters represent six degrees of freedom. 17. The method of claim 16, wherein the first set of transformation parameters include five transformation parameters and the second set of transformation parameters include five transformation parameters. 18. The method of claim 17, wherein the first set of transformation parameters represents a first five degrees of freedom, and the second set of transformation parameters represents a second five degrees of freedom, at least one of the first five degrees of freedom overlapping one of the second five degrees of freedom. 19. The method of claim 16, wherein each of the first set of 2D images and the second set of 2D images correspond to perturbations from said initial position along at most two degrees of freedom. 20. The method of claim 19, wherein the first set of 2D images corresponds to out of plane rotations for a first plane of the first x-ray image and the second set of 2D images corresponds to out of plane rotations for a second plane of the second x-ray image. 21. The method of claim 20, wherein one of the out of plane rotations for the first plane is an in plane rotation for the second plane. 